# CH6-3

## MAC（Medium access control） 的性能

### 性能指标

- 媒体利用率
  - 帧传输时间与共享媒体占用时间的比值U=帧传输时间/一帧的总时间
- 相对传播时间a=传播时间/传输时间
- 或a=数据路径长度（比特）/标准帧长度（比特）

### 不同的网络

-  无竞争
  -  点对点链路
  - 环形局域网
- 随机访问
  - ALOHA、时隙 ALOHA
  - CSMA/CD（载波侦听多路访问 / 冲突检测）

![](/Images/039b1631-d883-443f-b5fe-b5f51939f94e.png)

![](/Images/ffc5f065-691f-4c14-9c2d-8662907f9749.png)

---

![](/Images/ea65e9ad-09d3-4561-9d02-06f511cbed93.png)

![](/Images/d6a7fe1f-450c-4ca7-87e9-0cbbe436239d.png)

---

### 时隙 ALOHA

-  所有帧大小相同
-  时间被均匀划分为时隙
-  节点保持同步
-  传输在时隙边界开始
-  帧要么完全不重叠，要么完全重叠

工作机制：
N 个节点有大量帧需要发送
每个节点在每个时隙以概率 p 传输帧，直至成功

![](/Images/89d250eb-1e2c-41ca-ab3d-29587164480d.png)

![](/Images/a184ce3a-3b5e-4834-ad9b-cc585b8e5281.png)

![](/Images/10ac013f-332e-4552-8581-078decfc08a5.png)

---

### 纯 ALOHA

-  更简单，但冲突概率会增加
  -  在 t0 时刻发送的帧会与在 [t0−1, t0+1] 时间段内发送的其他帧发生冲突
- 假设：
- N 个节点有大量帧需要发送，每个节点在任意时刻以概率 p 发送帧
- 问：最大利用率 U 是多少？

![](/Images/74e4647e-a983-4ecd-972a-86db15d7e52c.png)

![](/Images/ffe2220f-80f7-420a-8d83-4988360ec1a7.png)

---

### CSMA/CD（p - 坚持）：最大利用率

- 竞争时隙以冲突结束
- 竞争间隔是一系列竞争时隙的序列
- 竞争间隔中一个时隙的长度为 2a（在最坏情况下，检测竞争需耗时 2a）
- 假设采用 p - 坚持机制：
  - 站点在一个时隙中尝试传输的概率为 p
- 问：最大利用率 U 是多少？

![](/Images/96cdc6c2-e16c-4900-b08a-0371b310141f.png)

![](/Images/014f4218-f827-4964-8f64-f7696b5252a2.png)

![](/Images/d0afaeed-28d4-4c1d-92da-3a755d667ebe.png)

---

## MAC 地址与发现

### 什么是 MAC 地址？

-  媒体访问控制（MAC）地址
  - 与网络适配器关联的数字地址
  - 48 位的扁平命名空间（例如，十六进制表示为 00-15-C5-49-04-A9）
  - 具有唯一性，在适配器制造时硬编码于其中
- 分层分配机制
  - 地址块：由 IEEE 分配给供应商（如戴尔）
    - 前 24 位（例如，00-15-C5-**-**-**）
  - 适配器地址：由供应商从其分配的地址块中指定
    - 后 24 位

![](/Images/ee1b62f0-ae99-4fb5-ae22-111a67ee8c08.png)

### 发现

-  主机 “诞生” 时仅知晓自身的 MAC 地址
-  在与远程主机 B 通信前，必须获取大量信息
  -  我的 IP 地址是什么？
  - B 的 IP 地址是什么？（远程）
  - B 的 MAC 地址是什么？（若 B 在本地）
  - 我的第一跳路由器地址是什么？（若 B 不在本地）

### ARP 和 DHCP

- 链路层发现协议
  - ARP → 地址解析协议
  - DHCP → 动态主机配置协议
  - 仅限于单个局域网（LAN）
  - 依赖广播功能

![](/Images/45119572-6b3c-48d2-b1f4-cae66eb611c9.png)

- 链路层发现协议
- 具备两项功能
  - 本地终端主机的发现
    - 用于同一局域网内主机间的通信
- 与远程主机的引导通信
  - 我的 IP 地址是什么？
  - 我的本地 DNS 服务器是谁 / 在哪里？
  - 我的第一跳路由器是谁 / 在哪里？

![](/Images/1d16db3c-975a-4cfe-97ee-12082a5fbe7b.png)

---

### DHCP

- 动态主机配置协议
  - 在 RFC 2131 中定义
- 主机使用 DHCP 来发现
  - 自身的 IP 地址
  - 子网掩码
  - 本地 DNS 服务器的 IP 地址
  - 第一跳 “默认” 路由器的 IP 地址

![](/Images/ebe73759-b62c-443e-927a-18fe11975ff1.png)

### DHCP 的典型流程

- 客户端在其所在子网广播 DHCP-DISCOVER 消息

- 每台服务器可能会用 DHCP-OFFER 消息进行响应

- 客户端选择一台服务器，并广播包含该服务器 IP 的 DHCP-REQUEST 消息

- 被选中的服务器确认绑定关系，并以 DHCP-ACK 消息作出响应

- 客户端在 DHCP-ACK 消息中设置其配置参数
- 客户端通过 DHCP-RELEASE 消息释放绑定关系
- 若客户端未在绑定到期前进行更新（重新绑定），绑定将失效

![](/Images/7d7b902c-425d-450b-b0ba-43f4217cd30d.png)

![](/Images/08ba1731-88ec-468c-a1af-6ee3f2c127e3.png)

---

### 故障情况下的软状态

![](/Images/59ffd1e3-75c2-4512-a3ed-2766405af8b6.png)

当主机 XYZ 故障时会发生什么？

- 来自 XYZ 的刷新操作停止
- 服务器在约（租约周期）后回收 a.b.c.d 地址

当服务器出现故障时会发生什么？

- 服务器不再发送 ACK（确认）消息
- XYZ 在约（租约周期）后释放地址，并发送新的请求
- 新的 DHCP 服务器可从 “冷启动” 状态启动，约在一个租约时间内恢复正常

如果网络出现故障会发生什么？

- 刷新请求和 ACK（确认）消息无法传递
- XYZ 释放地址，DHCP 服务器回收该地址

---



### MAC 地址解析问题

- 用户 137.196.7.23 想要 Ping 137.196.7.88
  - 源 IP：137.196.7.23
  - 目标 IP：137.196.7.88
  - 源 MAC：71-65-F7-2B-08-53
  - 目标 MAC：？
- 传递数据需要知道其 MAC 地址
- 在局域网中，ARP 用于根据 IP 地址获取主机 / 路由器的 MAC 地址

### 地址解析协议

-  ARP（地址解析协议）

  - 将 IP 地址映射到 MAC 地址

  - 192.168.1.2 → 00-15-C5-49-04-A9

  - 仅在局域网中生效

- 对比：DNS（域名系统）
  - 将域名映射到 IP 地址
  - [Baidu.com](https://Baidu.com) → 220.181.38.148

### ARP 流程

- 每个主机维护一张 ARP 表
  - （IP 地址→MAC 地址）对的列表
- 发送方
  - 先查询本地缓存，若没有
  - 构造 ARP 请求，插入 <发送方 IP、发送方 MAC、目标 IP>
  - 使用 MAC 帧广播
  - 缓存目标的 <MAC, IP> 对并添加时间戳
- 接收方
  - 检查目标 IP，若匹配
  - 构造 ARP 应答，插入 <目标 IP、目标 MAC>
  - 使用 MAC 帧发送至发送方 MAC 地址
  - 缓存发送方的 <MAC, IP> 对并添加时间戳

![](/Images/085d99e3-2de8-4e3b-bfed-5e16df04a5a5.png)

### 如果目标是远程的会怎样？

-  查找第一跳路由器的 MAC 地址
  -  1.2.3.48 使用 ARP 查找第一跳路由器 1.2.3.19 的 MAC 地址，而非最终目标 IP 地址

- 红色主机如何知道目标不在本地？
  - 使用子网掩码（通过 DHCP 发现）

- 红色主机如何知道 1.2.3.19？
  - 同样通过 DHCP

![](/Images/011303aa-b587-4bc7-91f0-8f3383ee63cd.png)

![](/Images/d0e1bbb0-22ea-4623-aa1c-b5087ce2c8c3.png)

### ARP 和 DHCP 中的关键思想

- 广播：可利用广播建立联系
  - 因作用范围有限而具备可扩展性
- 缓存：暂时记忆历史信息
  - 存储已获取的信息以降低开销
- 软状态：最终会遗忘历史信息
  - 为信息关联生存时间（TTL）字段
  - …… 并据此刷新或丢弃信息
  - 这是应对不可预测变化时保持鲁棒性的关键

![](/Images/5801130e-7e29-4b64-8d97-2f6e97b76327.png)

### 发现机制

- 我们已经了解了两种方法
  - 广播（ARP、DHCP）
    - 洪泛方式不具备可扩展性
    - 不存在单点故障
    - 零配置
- 目录服务（DNS）
  - 无洪泛 / 具备可扩展性
  - 目录根节点较为脆弱（缓存是关键）
  - 需要配置引导（本地服务器、根服务器等）

---

![](/Images/f26cdb01-122d-4d69-92ae-ac4eba7013dd.png)
